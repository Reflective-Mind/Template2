import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';
import * as lucide from 'lucide-react';
import * as framerMotion from 'framer-motion';
import ReactDOM from 'react-dom/client';
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

const ENV = {
  isLocal: typeof window !== 'undefined' && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'),
  isProd: typeof window !== 'undefined' && window.location.hostname !== 'localhost'
};

/**
 * --- THE GODLIKE ENGINE (v2.0) ---
 * A self-replicating, multi-file React environment.
 */
const ENGINE_SOURCE = "function ArchitectWorkshop({ initialFiles, mode = 'edit' }) {\n  // --- STATE ---\n  // files: Record<string, string> where key is filename (e.g., 'App.js') and value is code\n  const [files, setFiles] = useState(initialFiles || { 'App.js': '' });\n  const [activeFile, setActiveFile] = useState('App.js');\n  const [error, setError] = useState(null);\n  const [isEditorOpen, setIsEditorOpen] = useState(false);\n  const [showWorkshopUI, setShowWorkshopUI] = useState(false);\n  const [copyFeedback, setCopyFeedback] = useState(null);\n  const [babelReady, setBabelReady] = useState(false);\n  \n  const previewRef = useRef(null);\n  const rootInstance = useRef(null);\n  const isMounted = useRef(false);\n  \n  // Helper for Pure JS React\n  const h = React.createElement;\n\n  // 1. Lifecycle & Babel Loader\n  useEffect(() => {\n    isMounted.current = true;\n    if (typeof window !== 'undefined' && !window.Babel) {\n      const script = document.createElement('script');\n      script.src = 'https://unpkg.com/@babel/standalone/babel.min.js';\n      script.async = true;\n      script.onload = () => { if (isMounted.current) setBabelReady(true); };\n      document.head.appendChild(script);\n    } else {\n      setBabelReady(true);\n    }\n    return () => {\n      isMounted.current = false;\n      if (rootInstance.current) {\n         setTimeout(() => { rootInstance.current?.unmount(); rootInstance.current = null; }, 0);\n      }\n    };\n  }, []);\n\n  // 2. Auto-Run\n  useEffect(() => {\n    if (babelReady && files && isMounted.current) {\n      const timer = setTimeout(() => executeCode(), 100);\n      return () => clearTimeout(timer);\n    }\n  }, [babelReady, files]);\n\n  // 3. Compiler & Linker\n  const executeCode = () => {\n    if (!previewRef.current || !window.Babel || !isMounted.current) return;\n    setError(null);\n\n    try {\n      if (!rootInstance.current && previewRef.current) {\n        rootInstance.current = ReactDOM.createRoot(previewRef.current);\n      }\n\n      // Simple Bundler: We will process 'App.js' as entry.\n      // For checking imports, we'd need a more complex solution, but here we can mock a module system \n      // by evaluating files in dependency order or just putting them all in a common scope.\n      // Since this is a simple self-contained app, we will use a naive approach:\n      // 1. Transpile all files.\n      // 2. Create a 'require' shim.\n      \n      const transpiledFiles = {};\n      \n      // Transpile each file\n      Object.keys(files).forEach(filename => {\n        let code = files[filename] || \"\";\n        // Handle basic exports for our naive module system\n        // Standardize Export Default\n        if (code.match(/export\\s+default\\s+function/)) {\n            code = code.replace(/export\\s+default\\s+function\\s+(\\w+)/, \"const __default__ = function $1\");\n            code = code.replace(/export\\s+default\\s+function/, \"const __default__ = function\");\n        } else if (code.match(/export\\s+default\\s+/)) {\n            code = code.replace(/export\\s+default\\s+/, \"const __default__ = \");\n        } else {\n             // Fallback if no export default found, assume the last defined component or logic\n        }\n        \n        // Handle named exports (simplified)\n        code = code.replace(/export\\s+const\\s+(\\w+)/g, \"const $1\");\n\n        transpiledFiles[filename] = window.Babel.transform(code, { \n            presets: [\"react\", [\"env\", { modules: false }]] \n        }).code;\n      });\n\n      // Execution Context\n      // We will perform a topological sort or simply naive evaluation if we assume shallow dependencies.\n      // For robust multi-file, we'll eval them in a shared scope where 'require' can resolve them.\n      // BUT, 'App.js' is our entry.\n      \n      const scope = {\n        React, useState, useEffect, useRef, useMemo, useCallback, framerMotion, lucide, clsx, twMerge, ...lucide,\n        // Mock require for internal files\n        require: (path) => {\n            // path might be './Hero.js' or 'lucide-react'\n             // Remove ./ prefix\n            const cleanPath = path.replace(/^\\.\\//, '');\n            if (transpiledFiles[cleanPath]) {\n                 // This is tricky without a real module system. \n                 // We actually need to EVAL the required file and get its exports.\n                 // See moduleSystem below.\n                 throw new Error(\"Sync require not fully supported in this light engine. Use a single file or 'App.js' as entry.\");\n            }\n            return null;\n        }\n      };\n\n      // NAIVE LINKER: Concat all auxiliary files BEFORE App.js, wrapped in closures?\n      // Better: Just concat them all into one big script context if they don't have conflicting var names.\n      // BEST FOR NOW: 'App.js' is the MAIN. If you want components, define them in other files and we will include them.\n      // actually, to support 'import Header from \"./Header\"', we need a custom plugin or regex replacer.\n      // LET'S SIMPLIFY: We will combine all files into one execution scope for now,\n      // treating them as if they were just one long file, BUT removing imports/exports between them.\n      // This is a 'bundle' approach.\n      \n      let bundle = \"\";\n      \n      // Sort files: Helpers first, App.js last.\n      const sortedKeys = Object.keys(files).sort((a,b) => {\n          if (a === 'App.js') return 1;\n          if (b === 'App.js') return -1;\n          return a.localeCompare(b);\n      });\n\n      sortedKeys.forEach(filename => {\n         let code = files[filename];\n         // Remove imports referring to local files to prevent errors\n         code = code.replace(/import\\s+.*?from\\s+['\"]\\.\\/.*?['\"];?/g, \"\");\n         // Remove external imports (already in scope)\n         code = code.replace(/import\\s+.*?from\\s+['\"].*?['\"];?/g, \"\");\n         \n         // Normalize exports so variables stay in scope\n         code = code.replace(/export\\s+default\\s+/g, \"\");\n         code = code.replace(/export\\s+/g, \"\");\n         \n         bundle += `\\n// --- ${filename} ---\\n${code}\\n`;\n      });\n      \n      // Now transpile the WHOLE bundle\n       const transpiledBundle = window.Babel.transform(bundle, { \n            presets: [\"react\", [\"env\", { modules: false }]] \n       }).code;\n\n      const executeBody = `\n        try {\n            ${transpiledBundle}\n            \n            // Find the entry point component. Usually 'App' or 'RootApp' or whatever was default exported in App.js\n            // Since we stripped exports, we look for 'App' constructor.\n            const Target = (typeof App !== 'undefined' ? App : (typeof Main !== 'undefined' ? Main : null));\n            if (Target) {\n                render(React.createElement(Target));\n            } else {\n                 // Fallback: Check if there's a function named the same as the file minus extension?\n            }\n        } catch(e) { throw e; }\n      `;\n\n      const finalScope = {\n         ...scope,\n         render: (c) => { if (isMounted.current && rootInstance.current) rootInstance.current.render(h(React.Fragment, { key: Date.now() }, c)); }\n      };\n      \n      new Function(...Object.keys(finalScope), executeBody)(...Object.values(finalScope));\n\n    } catch (err) {\n      if (isMounted.current) setError(err.message);\n    }\n  };\n\n  // 4. Hotkeys\n  useEffect(() => {\n    if (mode !== 'edit' || !isEditorOpen) return;\n    const handleKeys = (e) => {\n      if ((e.metaKey || e.ctrlKey) && e.key === \"Enter\") executeCode();\n      if ((e.metaKey || e.ctrlKey) && e.key === \"s\") { e.preventDefault(); saveAsDefault(); }\n    };\n    window.addEventListener(\"keydown\", handleKeys);\n    return () => window.removeEventListener(\"keydown\", handleKeys);\n  }, [isEditorOpen, mode, files]);\n  \n  useEffect(() => {\n     if (mode === 'edit') {\n         const toggle = (e) => { if (e.key === \"F8\") setShowWorkshopUI(p => !p); };\n         window.addEventListener(\"keydown\", toggle);\n         return () => window.removeEventListener(\"keydown\", toggle);\n     }\n  }, [mode]);\n\n  // 5. THE PERFECT SAVER (Multi-File Edition)\n  const saveAsDefault = () => {\n    // We need to reconstruct the RootApp manually with validity.\n    const q = \"'\";\n    const nl = \"\\n\";\n    const bl = \"`\";\n    \n    // Serialize files\n    // We will store them as a JSON object string in the new file\n    const filesJson = JSON.stringify(files, null, 2);\n    \n    // But we need to put this JSON into the template.\n    // We essentially need to recreate the `src/App.jsx` content.\n    // READ CAREFULLY: We are generating the string that IS the file `src/App.jsx`.\n    \n    const newFileContent = \n        `import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';` + nl +\n        `import * as lucide from 'lucide-react';` + nl +\n        `import * as framerMotion from 'framer-motion';` + nl +\n        `import ReactDOM from 'react-dom/client';` + nl +\n        `import { clsx } from 'clsx';` + nl +\n        `import { twMerge } from 'tailwind-merge';` + nl + nl +\n        `const ENV = { ` + nl +\n        `  isLocal: typeof window !== 'undefined' && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'), ` + nl +\n        `  isProd: typeof window !== 'undefined' && window.location.hostname !== 'localhost' ` + nl +\n        `};` + nl + nl +\n        `/**` + nl +\n        ` * --- THE GODLIKE ENGINE (v2.0) ---` + nl +\n        ` * A self-replicating, multi-file React environment.` + nl +\n        ` */` + nl +\n        `const ENGINE_SOURCE = ` + JSON.stringify(ENGINE_SOURCE) + `;` + nl + nl +\n        `// --- HYDRATE ENGINE ---` + nl +\n        `const ArchitectWorkshop = new Function('React', 'useState', 'useEffect', 'useRef', 'useMemo', 'useCallback', 'framerMotion', 'lucide', 'clsx', 'twMerge', 'ReactDOM', 'ENGINE_SOURCE', 'return ' + ENGINE_SOURCE)(React, useState, useEffect, useRef, useMemo, useCallback, framerMotion, lucide, clsx, twMerge, ReactDOM, ENGINE_SOURCE);` + nl + nl +\n        `// --- ROOT ENTRY ---` + nl +\n        `export default function RootApp() {` + nl +\n        `  const initialFiles = ` + filesJson + `;` + nl +\n        `  return React.createElement(ArchitectWorkshop, { initialFiles, mode: ENV.isLocal ? 'edit' : 'view' });` + nl +\n        `}`;\n\n    // Use the DOM hack to save (requires local server write permission/hack or copy-paste)\n    // Since we are in a browser environment usually, we copy to clipboard.\n    // BUT wait, if we are running locally, we might want to auto-save?\n    // The prompt implied \"Save as Default\" serializes it.\n    \n    navigator.clipboard.writeText(newFileContent).then(() => {\n        setCopyFeedback(\"save\");\n        setTimeout(() => setCopyFeedback(null), 2000);\n    }).catch(err => setError(\"Clipboard failed: \" + err));\n  };\n\n  // UI Components\n  const { Code2, Save, Copy, Check, X, File: FileIcon, Plus, Trash2 } = lucide;\n  const { AnimatePresence, motion } = framerMotion;\n\n  return h('div', { className: \"relative h-screen w-screen bg-[#020202] font-sans overflow-hidden text-white\" },\n    h('div', { ref: previewRef, className: \"h-full w-full\" }),\n    \n    mode === 'edit' && h(React.Fragment, null,\n      h(AnimatePresence, null,\n        showWorkshopUI && h(motion.div, { \n          initial: { opacity: 0, x: 20 }, animate: { opacity: 1, x: 0 }, exit: { opacity: 0, x: 20 },\n          className: \"fixed top-6 right-6 flex items-center gap-2 z-[500]\" \n        },\n          h('button', { onClick: () => setIsEditorOpen(true), className: \"p-3 bg-black/60 backdrop-blur-xl border border-white/10 rounded-full text-white/40 hover:text-amber-500 transition-all active:scale-95 shadow-xl\", title: \"Open Code\" }, h(Code2, { size: 16 })),\n          h('button', { onClick: saveAsDefault, className: \"p-3 bg-black/60 backdrop-blur-xl border border-white/10 rounded-full text-white/40 hover:text-blue-500 transition-all active:scale-95 shadow-xl\", title: \"Copy Full File to Clipboard\" }, copyFeedback === \"save\" ? h(Check, { size: 16, className: \"text-blue-500\" }) : h(Save, { size: 16 }))\n        )\n      ),\n      h(AnimatePresence, null,\n        isEditorOpen && h(motion.div, {\n          initial: { opacity: 0 }, animate: { opacity: 1 }, exit: { opacity: 0 },\n          className: \"fixed inset-0 z-[600] bg-black/80 backdrop-blur-3xl flex items-center justify-center p-8 lg:p-20\"\n        },\n          h(motion.div, {\n            initial: { scale: 0.95, y: 30 }, animate: { scale: 1, y: 0 }, exit: { scale: 0.95, y: 30 },\n            className: \"w-full max-w-6xl h-full flex flex-col bg-[#080808] border border-white/5 rounded-[2rem] shadow-2xl overflow-hidden\"\n          },\n             // Header\n             h('div', { className: \"flex items-center justify-between px-8 py-6 border-b border-white/5 bg-[#0a0a0a]\" },\n                h('div', {}, \n                    h('h3', { className: \"font-serif italic text-xl text-white tracking-widest uppercase\" }, \"Godlike Engine v2\"),\n                    h('p', { className: \"text-[9px] text-amber-500/80 uppercase tracking-[0.3em] font-bold\" }, babelReady ? \"Neural Link Active\" : \"Initializing...\")\n                ),\n                h('button', { onClick: () => setIsEditorOpen(false), className: \"text-white/20 hover:text-white transition-colors\" }, h(X, { size: 20 }))\n             ),\n             \n             // Body: Sidebar + Editor\n             h('div', { className: \"flex-1 flex overflow-hidden\" },\n                // Sidebar (File Explorer)\n                h('div', { className: \"w-48 bg-[#050505] border-r border-white/5 flex flex-col\" },\n                    h('div', { className: \"p-4 space-y-2 overflow-y-auto flex-1\" },\n                        Object.keys(files).map(filename => \n                            h('button', { \n                                key: filename,\n                                onClick: () => setActiveFile(filename),\n                                className: `w-full text-left px-3 py-2 rounded-lg text-xs font-mono transition-all flex items-center justify-between group ${activeFile === filename ? 'bg-amber-500/10 text-amber-500' : 'text-neutral-500 hover:text-neutral-300'}`\n                            }, \n                                h('span', { className: \"truncate\" }, filename),\n                                filename !== 'App.js' && h(Trash2, {\n                                    size: 10, \n                                    className: \"opacity-0 group-hover:opacity-100 hover:text-rose-500\", \n                                    onClick: (e) => { e.stopPropagation(); const newFiles = {...files}; delete newFiles[filename]; setFiles(newFiles); if(activeFile===filename) setActiveFile('App.js'); }\n                                })\n                            )\n                        )\n                    ),\n                    h('div', { className: \"p-4 border-t border-white/5\" },\n                        h('button', { \n                            onClick: () => { const name = prompt(\"Filename?\", \"Component.js\"); if(name && !files[name]) setFiles({...files, [name]: \"export default function Component() {\\n  return <div>New Component</div>\\n}\" }); },\n                            className: \"w-full py-2 flex items-center justify-center gap-2 border border-dashed border-white/10 rounded-lg text-white/20 hover:text-white/60 hover:border-white/20 transition-all text-[10px] uppercase tracking-widest\"\n                        }, h(Plus, { size: 10 }), \"New File\")\n                    )\n                ),\n                \n                // Editor Area\n                h('div', { className: \"flex-1 flex flex-col bg-[#080808] relative\" },\n                    h('textarea', {\n                      value: files[activeFile] || \"\",\n                      onChange: (e) => setFiles({ ...files, [activeFile]: e.target.value }),\n                      spellCheck: \"false\",\n                      className: \"flex-1 bg-transparent p-8 font-mono text-xs text-neutral-400 focus:outline-none no-scrollbar leading-relaxed resize-none\",\n                      placeholder: \"// Write your React code here...\"\n                    }),\n                    h('div', { className: \"absolute bottom-6 right-8 flex gap-4\" },\n                        h('button', { \n                            onClick: () => executeCode(), \n                            className: \"px-6 py-2 bg-white text-black rounded-full text-[10px] uppercase font-bold hover:bg-amber-500 transition-all shadow-lg\"\n                        }, \"Apply Logic\")\n                    )\n                )\n             ),\n             \n             error && h('div', { className: \"p-4 bg-rose-950/20 border-t border-rose-500/20 text-rose-400 text-[10px] font-mono\" }, error)\n          )\n        )\n      )\n    )\n  );\n}";

// --- HYDRATE ENGINE ---
const ArchitectWorkshop = new Function('React', 'useState', 'useEffect', 'useRef', 'useMemo', 'useCallback', 'framerMotion', 'lucide', 'clsx', 'twMerge', 'ReactDOM', 'ENGINE_SOURCE', 'return ' + ENGINE_SOURCE)(React, useState, useEffect, useRef, useMemo, useCallback, framerMotion, lucide, clsx, twMerge, ReactDOM, ENGINE_SOURCE);

// --- ROOT ENTRY ---
export default function RootApp() {
  const initialFiles = {
    "App.js": `/**\n * AURELIAN - V8: THE NEURAL VAULT\n * Focus: High-fidelity futuristic luxury, resolving SVG gradient errors, and structural depth.\n * Style: Deep obsidian interface, global liquid-gold definitions, and ambient HUD data.\n */\n\n// --- Global Definitions: Ensuring gradients are always accessible to all components ---\nconst GlobalDefinitions = () => (\n  <svg style={{ height: 0, width: 0, position: 'absolute', visibility: 'hidden' }}>\n    <defs>\n      <linearGradient id=\"goldGrad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n        <stop offset=\"0%\" stopColor=\"#8E6E36\" />\n        <stop offset=\"20%\" stopColor=\"#C5A059\" />\n        <stop offset=\"50%\" stopColor=\"#F9F1D1\" />\n        <stop offset=\"80%\" stopColor=\"#C5A059\" />\n        <stop offset=\"100%\" stopColor=\"#8E6E36\" />\n      </linearGradient>\n      <filter id=\"goldGlow\">\n        <feGaussianBlur stdDeviation=\"4\" result=\"blur\" />\n        <feComposite in=\"SourceGraphic\" in2=\"blur\" operator=\"over\" />\n      </filter>\n    </defs>\n  </svg>\n);\n\nconst HUDOverlay = ({ activeIndex, time }) => (\n  <div className=\"fixed inset-0 pointer-events-none z-50 font-mono text-[7px] md:text-[8px] tracking-[0.3em] text-[#C5A059]/40 uppercase antialiased\">\n    {/* Perimeter Frame */}\n    <div className=\"absolute inset-8 border border-white/[0.03] pointer-events-none\">\n      <div className=\"absolute top-0 left-0 w-4 h-4 border-t border-l border-[#C5A059]/40\"></div>\n      <div className=\"absolute top-0 right-0 w-4 h-4 border-t border-r border-[#C5A059]/40\"></div>\n      <div className=\"absolute bottom-0 left-0 w-4 h-4 border-b border-l border-[#C5A059]/40\"></div>\n      <div className=\"absolute bottom-0 right-0 w-4 h-4 border-b border-r border-[#C5A059]/40\"></div>\n    </div>\n\n    {/* Header HUD */}\n    <div className=\"absolute top-12 left-12 flex flex-col gap-2\">\n      <div className=\"flex items-center gap-3\">\n        <lucide.Cpu className=\"w-3 h-3 text-[#C5A059] animate-pulse\" strokeWidth={1} />\n        <span className=\"text-white/80 font-semibold tracking-[0.4em]\">CORE_LINK: ESTABLISHED</span>\n      </div>\n      <div className=\"flex flex-col opacity-50 space-y-1\">\n        <div>NODE: GENEVA_IV_SECURE</div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-[1px] bg-[#C5A059]/20\"></div>\n          <span>SIGNAL_STRENGTH: 99.8%</span>\n        </div>\n      </div>\n    </div>\n\n    <div className=\"absolute top-12 right-12 text-right\">\n      <div className=\"flex items-center justify-end gap-3 mb-1\">\n        <span className=\"text-white/80\">VAULT_AUTH: SUCCESS</span>\n        <lucide.Lock className=\"w-3 h-3 text-[#C5A059]\" strokeWidth={1} />\n      </div>\n      <div className=\"opacity-40\">SESSION_ID: {Math.random().toString(16).slice(2, 10).toUpperCase()}</div>\n    </div>\n\n    {/* Center Left: Spatial Coordinates */}\n    <div className=\"absolute left-12 top-1/2 -translate-y-1/2 space-y-6\">\n      <div className=\"flex flex-col items-center gap-4 py-8 border-y border-white/[0.05]\">\n        <div className=\"rotate-90 origin-center whitespace-nowrap opacity-30\">COORDINATE_GRID_X</div>\n        <div className=\"h-12 w-[1px] bg-gradient-to-b from-transparent via-[#C5A059]/40 to-transparent\"></div>\n        <div className=\"rotate-90 origin-center whitespace-nowrap font-bold text-[#C5A059]\">46.2044Â° N</div>\n      </div>\n    </div>\n\n    {/* Footer HUD: Data Streams */}\n    <div className=\"absolute bottom-12 left-12 right-12 flex justify-between items-end\">\n      <div className=\"max-w-[200px] space-y-4\">\n        <div className=\"flex items-center gap-3\">\n          <lucide.Target className=\"w-3 h-3\" strokeWidth={1} />\n          <span>ASSET_SCAN_INIT</span>\n        </div>\n        <div className=\"grid grid-cols-2 gap-x-8 gap-y-1 opacity-40\">\n          <div>OBJ_MAP:</div><div className=\"text-right\">V_ACTIVE</div>\n          <div>THERMAL:</div><div className=\"text-right\">STABLE</div>\n          <div>VOID_REF:</div><div className=\"text-right\">0.00{activeIndex}</div>\n        </div>\n      </div>\n\n      <div className=\"flex flex-col items-end gap-2\">\n        <div className=\"flex items-center gap-4 text-[10px] tabular-nums font-light text-white/60\">\n          <span>{time.toLocaleTimeString()}</span>\n          <div className=\"w-1 h-1 bg-[#C5A059] rounded-full\"></div>\n          <span>30.12.2025</span>\n        </div>\n        <div className=\"flex gap-1\">\n          {[...Array(20)].map((_, i) => (\n            <div key={i} className={\`w-[2px] h-1 \${i < (activeIndex + 1) * 5 ? 'bg-[#C5A059]' : 'bg-white/5'}\`}></div>\n          ))}\n        </div>\n      </div>\n    </div>\n  </div>\n);\n\nconst GoldEntity = ({ type, active }) => {\n  const baseClasses = \`w-72 h-72 md:w-[32rem] md:h-[32rem] transition-all duration-[4s] cubic-bezier(0.16, 1, 0.3, 1)\`;\n  const activeClasses = active ? 'opacity-100 scale-100 blur-0' : 'opacity-0 scale-90 blur-3xl';\n\n  const entities = [\n    // Entity 1: Geometric Core\n    <svg viewBox=\"0 0 200 200\" fill=\"none\">\n      <circle cx=\"100\" cy=\"100\" r=\"95\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.1\" />\n      <path d=\"M100 20L180 100L100 180L20 100L100 20Z\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.5\" filter=\"url(#goldGlow)\" />\n      <path d=\"M100 40L160 100L100 160L40 100L100 40Z\" fill=\"url(#goldGrad)\" opacity=\"0.8\" />\n      <circle cx=\"100\" cy=\"100\" r=\"30\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.2\" />\n    </svg>,\n    // Entity 2: Liquid Orbitals\n    <svg viewBox=\"0 0 200 200\" fill=\"none\">\n      <ellipse cx=\"100\" cy=\"100\" rx=\"90\" ry=\"30\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.5\" transform=\"rotate(45 100 100)\" />\n      <ellipse cx=\"100\" cy=\"100\" rx=\"90\" ry=\"30\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.5\" transform=\"rotate(-45 100 100)\" />\n      <circle cx=\"100\" cy=\"100\" r=\"40\" fill=\"url(#goldGrad)\" opacity=\"0.9\" />\n      <circle cx=\"100\" cy=\"100\" r=\"60\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.2\" strokeDasharray=\"1 5\" />\n    </svg>,\n    // Entity 3: Symmetery Prism\n    <svg viewBox=\"0 0 200 200\" fill=\"none\">\n      {[...Array(6)].map((_, i) => (\n        <path \n          key={i} \n          d=\"M100 100L150 50L100 0L50 50L100 100Z\" \n          fill=\"url(#goldGrad)\" \n          opacity={0.3 + (i * 0.1)}\n          transform={\`rotate(\${i * 60} 100 100)\`}\n        />\n      ))}\n      <rect x=\"80\" y=\"80\" width=\"40\" height=\"40\" stroke=\"url(#goldGrad)\" strokeWidth=\"1\" transform=\"rotate(45 100 100)\" />\n    </svg>,\n    // Entity 4: The Apex Symbol\n    <svg viewBox=\"0 0 200 200\" fill=\"none\">\n      <path d=\"M100 20L170 180H140L100 90L60 180H30L100 20Z\" fill=\"url(#goldGrad)\" />\n      <path d=\"M100 20L100 180\" stroke=\"url(#goldGrad)\" strokeWidth=\"0.2\" strokeDasharray=\"4 4\" />\n      <circle cx=\"100\" cy=\"140\" r=\"10\" stroke=\"url(#goldGrad)\" strokeWidth=\"1\" />\n    </svg>\n  ];\n\n  return (\n    <div className={\`\${baseClasses} \${activeClasses} relative group\`}>\n      <div className=\"absolute inset-0 bg-[#C5A059]/10 blur-[100px] rounded-full scale-50 opacity-50 group-hover:scale-100 transition-transform duration-[5s]\"></div>\n      {entities[type % entities.length]}\n    </div>\n  );\n};\n\nconst ASSETS = [\n  { id: 1, image: \"https://images.unsplash.com/photo-1518005020251-58296d8f8d71?auto=format&fit=crop&q=80&w=2400\" },\n  { id: 2, image: \"https://images.unsplash.com/photo-1550684848-86a5d8727436?auto=format&fit=crop&q=80&w=2400\" },\n  { id: 3, image: \"https://images.unsplash.com/photo-1515549832467-8c441fe74996?auto=format&fit=crop&q=80&w=2400\" },\n  { id: 4, image: \"https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?auto=format&fit=crop&q=80&w=2400\" }\n];\n\nconst App = () => {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [time, setTime] = useState(new Date());\n\n  useEffect(() => {\n    const timer = setInterval(() => setTime(new Date()), 1000);\n    const handleScroll = () => {\n      const scrollPosition = window.scrollY;\n      const windowHeight = window.innerHeight;\n      const index = Math.round(scrollPosition / windowHeight);\n      if (index !== activeIndex) setActiveIndex(index);\n    };\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n      clearInterval(timer);\n    };\n  }, [activeIndex]);\n\n  return (\n    <div className=\"bg-[#000000] text-white selection:bg-[#C5A059] selection:text-black antialiased overflow-hidden\">\n      <GlobalDefinitions />\n      \n      {/* Structural Depth Grid */}\n      <div className=\"fixed inset-0 pointer-events-none opacity-20 z-0\">\n        <div className=\"absolute inset-0\" style={{\n          backgroundImage: \`linear-gradient(to right, rgba(197, 160, 89, 0.1) 1px, transparent 1px), linear-gradient(to bottom, rgba(197, 160, 89, 0.1) 1px, transparent 1px)\`,\n          backgroundSize: '100px 100px',\n        }}></div>\n      </div>\n      \n      <HUDOverlay activeIndex={activeIndex} time={time} />\n\n      {/* Main Identity Mark */}\n      <nav className=\"fixed top-0 w-full z-[60] px-16 py-12 flex items-center justify-between pointer-events-none\">\n        <div className=\"flex flex-col gap-1 pointer-events-auto group\">\n          <h1 className=\"text-[11px] tracking-[1.8em] font-serif font-light text-[#C5A059] uppercase transition-all duration-700 group-hover:tracking-[2em]\">\n            AURELIAN\n          </h1>\n          <div className=\"h-[0.5px] w-full bg-gradient-to-r from-[#C5A059] to-transparent\"></div>\n        </div>\n        \n        <div className=\"pointer-events-auto flex items-center gap-10 text-[8px] tracking-[0.4em] text-white/30 uppercase font-mono\">\n          <div className=\"flex items-center gap-2 group cursor-pointer hover:text-white transition-colors\">\n            <lucide.Globe className=\"w-3 h-3\" strokeWidth={1} />\n            <span>GLO_NET</span>\n          </div>\n          <div className=\"w-px h-6 bg-white/5\"></div>\n          <div className=\"flex items-center gap-2 group cursor-pointer hover:text-[#C5A059] transition-colors\">\n            <lucide.Shield className=\"w-3 h-3\" strokeWidth={1} />\n            <span>SECURE_V7</span>\n          </div>\n        </div>\n      </nav>\n\n      {/* Cinematic Viewport */}\n      <main className=\"snap-y snap-mandatory h-screen overflow-y-auto hide-scrollbar relative z-10\">\n        {ASSETS.map((asset, index) => (\n          <section \n            key={asset.id} \n            className=\"relative h-screen w-full snap-start flex items-center justify-center overflow-hidden\"\n          >\n            {/* Background Texture with Scan-line */}\n            <div className=\"absolute inset-0 z-0\">\n              <div className=\"absolute inset-0 bg-gradient-to-b from-black via-transparent to-black z-10\" />\n              <img \n                src={asset.image} \n                className={\`w-full h-full object-cover transition-all duration-[12s] ease-out \${activeIndex === index ? 'scale-105 opacity-20' : 'scale-100 opacity-0 blur-2xl'}\`}\n                alt=\"\"\n              />\n              <div className={\`absolute top-0 left-0 w-full h-[30vh] bg-gradient-to-b from-[#C5A059]/5 to-transparent z-20 pointer-events-none \${activeIndex === index ? 'animate-[scanline_10s_infinite_linear]' : ''}\`}></div>\n            </div>\n\n            {/* Central Focal Point */}\n            <div className=\"relative z-20 flex flex-col items-center\">\n              <GoldEntity type={index} active={activeIndex === index} />\n              \n              <div className={\`mt-20 text-center transition-all duration-[2s] delay-700 \${activeIndex === index ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-12'}\`}>\n                 <div className=\"flex flex-col items-center gap-4\">\n                    <span className=\"text-[7px] tracking-[1.2em] uppercase text-[#C5A059]/60\">Vault Encryption Alpha</span>\n                    <h2 className=\"text-4xl font-serif italic font-light tracking-[0.2em] text-white/90\">Asset_Lookbook_{index + 1}</h2>\n                    <div className=\"flex gap-16 mt-4\">\n                       <div className=\"flex flex-col gap-1\">\n                          <span className=\"text-[6px] text-white/20 uppercase tracking-widest\">Type</span>\n                          <span className=\"text-[8px] text-[#C5A059] uppercase tracking-widest\">Irreplaceable</span>\n                       </div>\n                       <div className=\"flex flex-col gap-1 text-right\">\n                          <span className=\"text-[6px] text-white/20 uppercase tracking-widest\">Status</span>\n                          <span className=\"text-[8px] text-[#C5A059] uppercase tracking-widest\">Vaulted</span>\n                       </div>\n                    </div>\n                 </div>\n              </div>\n            </div>\n\n            {/* Ambient Background Markers */}\n            <div className=\"absolute top-1/4 right-24 opacity-5 pointer-events-none hidden lg:block\">\n               <div className=\"text-[120px] font-serif italic text-white leading-none\">0{index + 1}</div>\n      </div>\n          </section>\n        ))}\n      </main>\n\n      {/* Finishing Aesthetics */}\n      <div className=\"fixed inset-0 pointer-events-none z-[100] border-[1px] border-white/5 m-12\"></div>\n      <div className=\"fixed inset-0 pointer-events-none z-[100] shadow-[inset_0_0_250px_rgba(0,0,0,1)]\"></div>\n\n      <style dangerouslySetInnerHTML={{ __html: \`\n        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,300;1,300&family=Inter:wght@100;200;400&family=JetBrains+Mono:wght@100;400&display=swap');\n        \n        body { \n          font-family: 'Inter', sans-serif; \n          background-color: #000000;\n          overflow: hidden;\n          cursor: crosshair;\n        }\n        \n        .font-serif { font-family: 'Playfair Display', serif; }\n        .font-mono { font-family: 'JetBrains Mono', monospace; }\n        \n        .hide-scrollbar::-webkit-scrollbar { display: none; }\n        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\n\n        main {\n          scroll-snap-type: y mandatory;\n          overflow-y: scroll;\n          height: 100vh;\n          scrollbar-width: none;\n        }\n\n        @keyframes scanline {\n          0% { transform: translateY(-100%); }\n          100% { transform: translateY(350%); }\n        }\n\n        svg {\n          filter: drop-shadow(0 0 80px rgba(197, 160, 89, 0.08));\n        }\n      \`}} />\n    </div>\n  );\n};\n\nexport default App;`\n
  }; \n  return React.createElement(ArchitectWorkshop, { initialFiles, mode: ENV.isLocal ? 'edit' : 'view' }); \n
} \n